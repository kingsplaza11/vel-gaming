{% extends "sa/base.html" %}
{% block title %}User Details • Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">{{ user_obj.username }}</h2>
        <small class="text-muted">UID: {{ user_obj.user_uid }}</small>
    </div>
</div>
<div class="d-flex gap-2 mt-4">
    <a href="{% url 'adminpanel:users' %}" class="btn btn-outline-light">
        ← Back
    </a>

    {% if request.user != user_obj %}
    <form method="post"
          action="{% url 'adminpanel:admin_delete_user' user_obj.id %}"
          onsubmit="return confirm('This will permanently delete the user. Continue?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">
            <i class="fas fa-trash me-1"></i> Delete User
        </button>
    </form>
    {% endif %}
</div>


<div class="row g-4">

    <!-- Account Info -->
    <div class="col-lg-6">
        <div class="dashboard-card">
            <h5 class="mb-3">Account Information</h5>

            <ul class="list-unstyled mb-0">
                <li><strong>Email:</strong> {{ user_obj.email }}</li>
                <li><strong>Full Name:</strong> {{ user_obj.full_name|default:"—" }}</li>
                <li><strong>Phone:</strong> {{ user_obj.phone_number|default:"—" }}</li>
                <li><strong>Date Joined:</strong> {{ user_obj.date_joined }}</li>
                <li><strong>Last Login:</strong> {{ user_obj.last_login|default:"Never" }}</li>
            </ul>
        </div>
    </div>

    <!-- Status -->
    <div class="col-lg-6">
        <div class="dashboard-card">
            <h5 class="mb-3">Account Status</h5>

            <span class="badge badge-soft-success mb-2">
                {% if user_obj.is_active %}Active{% else %}Blocked{% endif %}
            </span>

            {% if user_obj.is_staff %}
            <span class="badge badge-soft-info">Staff</span>
            {% endif %}

            {% if user_obj.is_superuser %}
            <span class="badge badge-soft-warning">Admin</span>
            {% endif %}
        </div>
    </div>

    <!-- Wallet -->
    <div class="col-lg-6">
        <div class="dashboard-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Wallet</h5>

                {% if wallet %}
                    <!-- <button class="btn btn-sm btn-outline-warning"
                            type="button"
                            onclick="document.getElementById('wallet-edit-form').classList.toggle('d-none')">
                        <i class="fas fa-edit me-1"></i> Edit Wallet
                    </button> -->
                {% endif %}
            </div>

            {% if wallet %}
                <!-- Read-only view -->
                <div id="wallet-view">
                    <p><strong>Bet Out Balance:</strong> ₦{{ wallet.balance|floatformat:2 }}</p>
                    <p><strong>Available:</strong> ₦{{ wallet.spot_balance|floatformat:2 }}</p>
                </div>

                <!-- Edit form (hidden by default) -->
                <!-- <form method="post"
                    action="{% url 'adminpanel:update_wallet' user_obj.id %}"
                    id="wallet-edit-form"
                    class="d-none mt-3">
                    {% csrf_token %}

                    <div class="mb-2">
                        <label class="form-label">Balance (₦)</label>
                        <input type="number" step="0.01" name="balance"
                            class="form-control"
                            value="{{ wallet.balance }}">
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Spot Balance (₦)</label>
                        <input type="number" step="0.01" name="spot_balance"
                            class="form-control"
                            value="{{ wallet.spot_balance }}">
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Locked Balance (₦)</label>
                        <input type="number" step="0.01" name="locked_balance"
                            class="form-control"
                            value="{{ wallet.locked_balance }}">
                    </div>

                    <div class="d-flex gap-2 mt-3">
                        <button type="submit" class="btn btn-warning w-100">
                            <i class="fas fa-save me-1"></i> Save Changes
                        </button>

                        <button type="button"
                                class="btn btn-outline-secondary w-100"
                                onclick="document.getElementById('wallet-edit-form').classList.add('d-none')">
                            Cancel
                        </button>
                    </div>
                </form> -->
            {% else %}
                <span class="badge badge-soft-secondary">No Wallet</span>
            {% endif %}
        </div>
    </div>

    <!-- Referrals -->
    <div class="col-lg-6">
        <div class="dashboard-card">
            <h5 class="mb-3">Referrals</h5>

            <p><strong>Referral Code:</strong> {{ user_obj.referral_code }}</p>

            {% if referrals %}
                <ul class="list-unstyled">
                    {% for r in referrals %}
                        <li>{{ r.username }} ({{ r.email }})</li>
                    {% endfor %}
                </ul>
            {% else %}
                <small class="text-muted">No referrals</small>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}
